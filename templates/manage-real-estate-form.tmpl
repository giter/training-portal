<!-- BEGIN PAGE CONTENT-->
<div class="portlet">
	<div class="portlet-title">
		
		<div class="caption">
			<div class="page-bar">
				<ul class="page-breadcrumb">
					<li>
						<i class="fa fa-home"></i>
						<a href="/manage/index.html">管理首页</a>
						<i class="fa fa-angle-right"></i>
					</li>
					<li>
						<a href="/manage/real-estate/index.html">新房管理</a>
						<i class="fa fa-angle-right"></i>
					</li>
					<li>
						<a href="/manage/real-estate/index.html">新房楼盘</a>
					</li>
				</ul>
			</div>
		</div>
	</div>
	<div class="portlet-body">
	</div>
</div>
<div class="row">
	{{if .RealEstate}}
	<ul class="nav nav-tabs">
		<li class="active">
			<a href="#tab-general" data-toggle="tab">
			楼盘资料 </a>
		</li>
		<li class="">
			<a href="#tab-enviroment" data-toggle="tab">
			参数环境</a>
		</li>
		<li class="">
			<a href="#tab-images" data-toggle="tab">
			楼盘图库 </a>
		</li>
		<li class="">
			<a href="#tab_images" data-toggle="tab">
			户型图库 </a>
		</li>
		<li class="">
			<a href="#tab_reviews" data-toggle="tab">
			楼盘评价
			</a>
		</li>
		<li>
			<a href="#tab_history" data-toggle="tab">
			历史价格 </a>
		</li>
	</ul>
	{{end}}
	<div class='tab-content no-space'>
		<div class="tab-pane active col-md-12" id='tab-general'>
		<form class='form-horizontal' id='form-real-estate'>
			<input type='hidden' name='Id' value='{{if .RealEstate}}{{.RealEstate.Id}}{{end}}' />
			<input type='hidden' name='MTime[Created]:number' value='{{if .RealEstate}}{{.RealEstate.MTime.Created}}{{end}}' />
			<table class="table table-striped table-bordered table-hover">
				<tbody>
					<tr>
						<td class='col-md-1'>
							<label class='control-label'>区域<span class='required' aria-required='true'>*</span></label>
						</td>
						<td class='col-md-4'>
							<div class='row'>
								<div class='col-md-4'>
									<select class='form-control' name='Area[Id]'>
										{{if .Areas}}
											{{if len .Areas}}
												{{range .Areas}}
													<option {{if $.RealEstate}}{{if equals $.RealEstate.Area.Id .Id}}selected{{end}}{{end}} value='{{.Id}}'>{{.Area}}</option>
												{{end}}
											{{end}}
										{{end}}
									</select>
								</div>
							</div>
						</td>
						<td class='col-md-1'><label class='control-label'>板块</label></td>
						<td class='col-md-4'>
							<div class='row'>
								<div class='col-md-4'>
									<!-- <input type='class' class='form-control' /> -->
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class='control-label'>楼盘名称<span class='required' aria-required='true'>*</span></label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									<input type='text' name='Name' value="{{if .RealEstate}}{{.RealEstate.Name}}{{end}}" class='form-control required'/>
								</div>
							</div>
						</td>
						<td><label class='control-label'>首字母<span class='required' aria-required='true'>*</span></label></td>
						<td>
							<div class='row'>
								<div class='col-md-2'>
									<input type='text' name='Captions' value="{{if .RealEstate}}{{.RealEstate.Caption}}{{end}}" class='form-control required'/>
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class='control-label'>物业类型<span class='required' aria-required='true'>*</span></label></td>
						<td>
							<div class='row'>
								{{range $k, $v := .CONTEXT.KVs.Usage.Nodes}}
									<div class='col-md-4'>
										<label class='control-label'>
											<input class='form-control' {{with $.RealEstate}}{{if in $.RealEstate.Usage $v.Value}}checked{{end}}{{end}} type='checkbox' name='Usage[]:number' value='{{$v.Value}}' /> {{$v.Name}}
										</label>
									</div>
								{{end}}
							</div>
						</td>
						<td><label class='control-label'>楼盘状态<span class='required' aria-required='true'>*</span></label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									{{range $k, $v := .CONTEXT.KVs.Schedule.Nodes}}
										<div class='col-md-4'>
											<label class='control-label'>
												<input class='form-control' {{with $.RealEstate}}{{if in $.RealEstate.Schedule $v.Value}}checked{{end}}{{end}} type='checkbox' name='Schedule[]:number' value='{{$v.Value}}' /> {{$v.Name}}
											</label>
										</div>
									{{end}}
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class='control-label'>楼型<span class='required' aria-required='true'>*</span></label></td>
						<td>
							<div class='row'>
								{{range $k, $v := .CONTEXT.KVs.Floor.Nodes}}
									<div class='col-md-4'>
										<label class='control-label'>
											<input class='form-control' {{with $.RealEstate}}{{if in $.RealEstate.Floor $v.Value}}checked{{end}}{{end}} type='checkbox' name='Floor[]:number' value='{{$v.Value}}' /> {{$v.Name}}
										</label>
									</div>
								{{end}}
							</div>
						</td>
						<td><label class='control-label'>价格</label></td>
						<td>
							<div class='row'>
								<div class='col-md-6'>
									<input class='form-control' type='text' name='Price:number' value='{{if .RealEstate.Price}}{{.RealEstate.Price}}{{end}}' />
								</div>
								<div class='col-md-3'>
									<select name='PriceType:number' class='form-control required'>
										{{range $k, $v := .CONTEXT.KVs.PriceType.Nodes}}
											<option {{with $.RealEstate}}{{if equals $.RealEstate.PriceType $v.Value}}selected{{end}}{{end}} value='{{$v.Value}}'>{{$v.Name}}</option>
										{{end}}
									</select>
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class='control-label'>开盘日期</label></td>
						<td>
							<div class='row'>
								<div class='col-md-6'>
									<div class="input-group date form-datetime">
										<input readonly type='class' class='form-control' name='Open' value="{{if .RealEstate}}{{if .RealEstate.Open}}{{.RealEstate.SOpen}}{{end}}{{end}}" />
										<span class="input-group-btn">
											<button class="btn default date-set" type="button"><i class="fa fa-calendar"></i></button>
										</span>
									</div>
								</div>
							</div>
						</td>
						<td><label class='control-label'>开盘日期<br/>（说明）</label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									<input class='form-control' type='text' name='OpenDate:string' value='{{if .RealEstate.OpenDate}}{{.RealEstate.OpenDate}}{{end}}' />
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class='control-label'>交房日期</label></td>
						<td>
							<div class='row'>
								<div class='col-md-6'>
									<div class="input-group date form-datetime">
										<input readonly type='class' class='form-control' name='Delivery' value="{{if .RealEstate}}{{if .RealEstate.Delivery}}{{.RealEstate.SDelivery}}{{end}}{{end}}" />
										<span class="input-group-btn">
											<button class="btn default date-set" type="button"><i class="fa fa-calendar"></i></button>
										</span>
									</div>
								</div>
							</div>
						</td>
						<td><label class='control-label'>交房日期<br/>（说明）</label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									<input class='form-control' type='text' name='DeliveryDate:string' value='{{if .RealEstate.DeliveryDate}}{{.RealEstate.DeliveryDate}}{{end}}' />
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class='control-label'>团购截止</label></td>
						<td>
							<div class='row'>
								<div class='col-md-6'>
									<div class="input-group date form-datetime">
										<input readonly type='class' class='form-control' name='GroupClose' value="{{if .RealEstate}}{{if .RealEstate.GroupClose}}{{.RealEstate.SGroupClose}}{{end}}{{end}}" />
										<span class="input-group-btn">
											<button class="btn default date-set" type="button"><i class="fa fa-calendar"></i></button>
										</span>
									</div>
								</div>
							</div>
						</td>
						<td><label class='control-label'>团购价格</label></td>
						<td>
							<div class='row'>
								<div class='col-md-6'>
									<input class='form-control' type='text' name='GroupPrice:number' value='{{if .RealEstate.GroupPrice}}{{.RealEstate.GroupPrice}}{{end}}' />
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class='control-label'>团购说明</label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									<input class='form-control' placeHolder="例如：房团独家优惠5万/套" type='text' name='GroupDescription:string' value='{{if .RealEstate.GroupDescription}}{{.RealEstate.GroupDescription}}{{end}}' />
								</div>
							</div>
						</td>
						<td><label class='control-label'>楼盘特色</label></td>
						<td>
							<div class='row'>
								<div class='col-md-12'>
									<input class='form-control' type='text' placeHolder='特色间逗号分隔，例如 "刚需房,改善房,团购房"' name="Features:string" value='{{if .RealEstate}}{{.RealEstate.Feature}}{{end}}' />
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class='control-label'>楼盘地址<span class='required' aria-required='true'>*</span></label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									<input type='text' name='Address' value='{{if .RealEstate}}{{.RealEstate.Address}}{{end}}' class='form-control required'/>
								</div>
							</div>
						</td>
						<td><label class='control-label'>工作时间<span class='required' aria-required='true'>*</span></label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									<input type='text' name='WorkTime:string' value='{{if .RealEstate}}{{if .RealEstate.WorkTime}}{{.RealEstate.WorkTime}}{{end}}{{end}}' class='form-control required'/>
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class='control-label'>房产公司</label></td>
						<td></td>
						<td><label class='control-label'>发展商</label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									<input type='text' name='Developer' class='form-control'/>
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class='control-label'>销售代理</label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									<input type='text' name='Agency' class='form-control'/>
								</div>
							</div>
						</td>
						<td><label class='control-label'>策划公司</label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									<input type='text' name='Machinate' class='form-control'/>
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class='control-label'>售楼热线<span class='required' aria-required='true'>*</span></label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									<input type='text' name='Phone[]' value="{{if .RealEstate}}{{if len .RealEstate.Phone}}{{index .RealEstate.Phone 0}}{{end}}{{end}}" class='form-control required'/>
								</div>
							</div>
						</td>
						<td><label class='control-label'>售楼地址<span class='required' aria-required='true'>*</span></label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									<input type='text' name='SellAddress[]' value="{{if .RealEstate}}{{if len .RealEstate.SellAddress}}{{index .RealEstate.SellAddress 0}}{{end}}{{end}}" class='form-control required'/>
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class='control-label'>400电话</label></td>
						<td>
							<div class='row'>
								<div class='col-md-4'>
									<input type='text' name='Order' value="{{if .RealEstate}}{{.RealEstate.Order}}{{end}}" class='form-control'/>
								</div>
								<div class='col-md-1' style='text-align: center;'>
									<label class='control-label'>转</label>
								</div>
								<div class='col-md-4'>
									<input type='text' name='OrderExtension:string' value="{{if .RealEstate}}{{.RealEstate.OrderExtension}}{{end}}" class='form-control number' />
								</div>
							</div>
						</td>
						<td><label class='control-label'>销售信息</label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									<input type='text' name='Sale' value="{{if .RealEstate}}{{if .RealEstate.Sale}}{{.RealEstate.Sale}}{{end}}{{end}}" class='form-control'/>
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class='control-label'>楼盘广告语<span class='required' aria-required='true'>*</span></label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									<input type='text' name='Adword:string' value="{{if .RealEstate}}{{if .RealEstate.Adword}}{{.RealEstate.Adword}}{{end}}{{end}}" class='form-control required'/>
								</div>
							</div>
						</td>
						<td><label class='control-label'>楼盘简介<span class='required' aria-required='true'>*</span></label></td>
						<td>
							<textarea cols=3 name='Brief' class='required form-control' >{{if and .RealEstate .RealEstate.Brief}}{{.RealEstate.Brief}}{{end}}</textarea>
						</td>
					</tr>
					<tr>
						<td><label class='control-label'>楼盘标志<span class='required' aria-required='true'>*</span></label></td>
						<td>
						
							<input type='file' class='form-control' id='file-logo' value="浏览图片" />
							<input type='text' class='form-control' name='Logo[Id]' style='display:none;'/>
							
							{{if and .RealEstate (.RealEstate.Logo) }}
								<a target='_blank' href='{{.RealEstate.Logo.Resource.Path}}'><img width=240 height=128 id='logo-preview' src='{{.RealEstate.Logo.Palm.Path}}' /></a>
							{{else}}
								<img width=240 height=128 id='logo-preview' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=' />
							{{end}}
						</td>
						<td><label class='control-label'>楼盘封面<span class='required' aria-required='true'>*</span></label></td>
						<td>
						
							<input type='file' class='form-control' id='file-cover' value="浏览图片" />
							<input type='text' class='form-control required' name='Cover[Id]' style='display:none;'/>
							
							{{if and .RealEstate (.RealEstate.Cover) }}
								<a target='_blank' href='{{.RealEstate.Cover.Resource.Path}}'><img width=240 height=128 id='cover-preview' src='{{.RealEstate.Cover.Palm.Path}}' /></a>
							{{else}}
								<img width=240 height=128 id='cover-preview' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=' />
							{{end}}
						</td>
					</tr>
					<tr>
						<td><label class='control-label'>楼盘介绍</label></td>
						<td colspan=3>
							<textarea name='Remark' class='ckeditor'>{{.RealEstate.Remark}}</textarea>
						</td>
					</tr>
					
					<tr>
						<td></td>
						<td colspan=3>
							<input type='submit' class='btn btn-success' value='保存' />
							<a class='btn' href='./index.html'>取消</a>
						</td>
					</tr>
				</tbody>
			</table>
			</form>
		</div>
		
		{{if .RealEstate}}
		<div class="tab-pane col-md-12" id='tab-enviroment'>
			<form class='form-horizontal' id='form-real-estate-enviroment'>
				<input type='hidden' name='Id' value='{{.RealEstate.Id}}' />
				<input type='hidden' name='MTime[Created]:number' value='{{.RealEstate.MTime.Created}}' />
				<table class="table table-striped table-bordered table-hover">
					<tr>
						<td><label class='control-label'>周边环境<span class='required' aria-required='true'>*</span></label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									<input type='text' name='Enviroment[Description]' value="{{if .RealEstate.Enviroment}}{{if .RealEstate.Enviroment.Description}}{{.RealEstate.Enviroment.Description}}{{end}}{{end}}" class='form-control required'/>
								</div>
							</div>
						</td>
						<td><label class='control-label'>车位比<span class='required' aria-required='true'>*</span></label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									<input type='text' name='Carbarn' value="{{if .RealEstate.Carbarn}}{{.RealEstate.Carbarn}}{{end}}" class='form-control required'/>
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class='control-label'>装修情况</label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									<input type='text' name='Decoration' value="{{if .RealEstate.Decoration}}{{.RealEstate.Decoration}}{{end}}" class='form-control'/>
								</div>
							</div>
						</td>
						<td><label class='control-label'>物业费</label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									<input type='text' name='PropertyFee' value="{{if .RealEstate.PropertyFee}}{{.RealEstate.PropertyFee}}{{end}}" class='form-control'/>
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class='control-label'>得房率</label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									<input type='text' name='EffectiveAreaRatio' value="{{if .RealEstate.EffectiveAreaRatio}}{{.RealEstate.EffectiveAreaRatio}}{{end}}" class='form-control'/>
								</div>
							</div>
						</td>
						<td><label class='control-label'>容积率</label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									<input type='text' name='FloorAreaRatio' value="{{if .RealEstate.FloorAreaRatio}}{{.RealEstate.FloorAreaRatio}}{{end}}" class='form-control'/>
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class='control-label'>绿化率</label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									<input type='text' name='GreenRatio' value="{{if .RealEstate.GreenRatio}}{{.RealEstate.GreenRatio}}{{end}}" class='form-control'/>
								</div>
							</div>
						</td>
						<td><label class='control-label'>学区</label></td>
						<td>
							<div class='row'>
								<div class='col-md-8'>
									<input type='text' name='Enviroment[Schools]' value="{{if .RealEstate.Enviroment}}{{if .RealEstate.Enviroment.Schools}}{{.RealEstate.Enviroment.Schools}}{{end}}{{end}}" class='form-control'/>
								</div>
							</div>
						</td>
					</tr>
					<tr>
						<td></td>
						<td colspan=3>
							<input type='submit' class='btn btn-success' value='保存' />
							<a class='btn' href='./index.html'>取消</a>
						</td>
					</tr>
				</table>
			</form>
		</div>
		{{end}}
		
		{{if .RealEstate}}
		<div class='tab-pane col-md-12' id="tab-images">
		
			{{range slice .PictureStat 0 1000000}}
				{{.Name}} [{{.Count}}]
			{{end}}
			
			<ul class='clearfix' style='padding:0'>
				{{range slice .PicturePage.Data 0 1000000}}
					<li style='float:left;list-style-type: none;padding:0;margin: 13px;height: 200px;'>
						<p><img width=240 src='{{.Palm.Path}}' /></p>
						<p>
							<span style='float:right;'>
								
								<a class='picture-title-edit' href='javascript:void(0)'>编辑</a> <a data-id="{{.Id}}" class='picture-delete' href='javascript:void(0)'>删除</a>
							</span>
							<span class='picture-title'>
								{{if .Title}}{{.Title}}{{else}}未标注{{end}}
							</span>
							<span class='picture-title-edition' style='display:none'>
								<input type='text' value="{{if .Title}}{{.Title}}{{end}}" style='width:64px;'/>
								<button data-created='{{.MTime.Created}}' data-id="{{.Id}}" class='picture-title-edition-button'>确定</button>
								<button class='picture-title-edition-cancel'>取消</button>
							</span>
						</p>
						<p>
							{{$.CONTEXT.KVs.PictureType.Name .Type}} {{.MTime.SCreated}}
						</p>
					</li>
				{{end}}
			</ul>
			
			{{.PicturePage.Page.SetURL .CONTEXT.URL.String}}
			{{template "pager" .PicturePage}}
		
			<form class='form-horizontal' id='form-real-estate-picture'>
			
				<input type='hidden' name="Rid" value="{{.RealEstate.Id}}" />
				<input type='hidden' name="RType" value="RealEstate" />
				<input type='hidden' name="Resource[Id]" value="" />
				<input type='hidden' name="Width:number" value="" />
				<input type='hidden' name="Height:number" value="" />
				<table class="table table-striped table-bordered table-hover">
					<tbody>
						<tr>
							<td class='col-md-2'><label class='control-label'>图片类型</label></td>
							<td class='col-md-10'>
							
								<select class='form-control' name="Type:number" >
									{{range $k, $v := .CONTEXT.KVs.PictureType.Nodes}}
										<option value="{{$v.Value}}">{{$v.Name}}</option>
									{{end}}
								</select>
							</td>
						</tr>
						<tr>
							<td class='col-md-2'><label class='control-label'>图片上传</label></td>
							<td class='col-md-10'>
							
								<input type='file' id='PictureUpload' />
								
								<br/>
								
								<img id='pic-preview' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=' />
							</td>
						</tr>
						<tr>
							<td class='col-md-2'><label class='control-label'>图片名称</label></td>
							<td class='col-md-10'>
							
								<input type='text' name='Title' class='form-control' value="" />
							</td>
						</tr>
						<tr>
							<td class='col-md-2'><label class='control-label'></label></td>
							<td class='col-md-10'>
								<input type='submit' class='btn btn-primary' value='上传' />
							</td>
						</tr>
					</tbody>
				</table>
			</form>
		</div>
		{{end}}
	</div>
</div>

<!-- END PAGE CONTENT-->

<!-- BEGIN CURRENT CONTEXT -->
<script type="text/javascript">

var PageLogical = function () {
	
	function FormInits(){
		
		$("#file-logo").upload({
			
			buttonText: "浏览图片",
			fileTypeDesc : '图片文件',
			fileTypeExts : '*.gif; *.jpg; *.png',
			fileSizeLimit: 2048,
			queueSizeLimit: 1,
			multi: false,
			uploader:"/manage/upload.json",
			uploadScript: "/manage/upload.json",
			success: function(file ,data){
				
				var o = JSON.parse(data);
				
				JWS("/manage/picture/upsert.json", {
					Resource : {
						Id: o.Id
					},
					Type: 100
				}).success(function(data){
					
					var form = $("#form-real-estate");
					form.find('input[name="Logo[Id]"]').val(data.Id)
					$('#logo-preview').attr("src", o.Path)
				})
				
			}
		});
		
		$("#file-cover").upload({
			
			buttonText: "浏览图片",
			fileTypeDesc : '图片文件',
			fileTypeExts : '*.gif; *.jpg; *.png',
			fileSizeLimit: 2048,
			queueSizeLimit: 1,
			multi: false,
			uploader:"/manage/upload.json",
			uploadScript: "/manage/upload.json",
			success: function(file ,data){
				
				var o = JSON.parse(data);
				
				JWS("/manage/picture/upsert.json", {
					Resource : {
						Id: o.Id
					},
					Type: 100
				}).success(function(data){
					
					var form = $("#form-real-estate");
					form.find('input[name="Cover[Id]"]').val(data.Id)
					$('#cover-preview').attr("src", o.Path)
				})
				
			}
		});
		
		$(".picture-delete").click(function(){
			
			var that = this
			
				
				bootbox.confirm("是否确认删除?", function(ok) {
		    		if(!ok) return;
		    		
					JWS("/manage/picture/delete.json", {Id:$(that).attr("data-id")}).success(function(){
		    			$(that).parents("li").first().remove();
					});
		        }); 
				
		});
		
		$(".picture-title-edit").click(function(){
			
			$(this).parents("li").first().find(".picture-title-edition").show();
			$(this).parents("li").first().find(".picture-title").hide();
		})
		
		$(".picture-title-edition-button").click(function(){
			
			var that = this
			var title = $(this).prev().val()
			JWS("/manage/picture/upsert.json", {
				
				Id : $(this).attr('data-id'),
				Title: title,
				MTime: {
					Created: $(this).data("created")
				}
			}).success(function(){
				
				$(that).parents("li").first().find(".picture-title").html(title)
				$(that).next().click();
			})
		});
		
		$(".picture-title-edition-cancel").click(function(){
			
			$(this).parent().hide().prev().show();
		})
		
		$('#pic-preview').load(function(){
			
			var form = $("#form-real-estate-picture");
			
			form.find('[name="Width:number"]').val($(this).width())
			form.find('[name="Height:number"]').val($(this).height())
		});
		
		$("#PictureUpload").upload({
			
			buttonText: "浏览图片",
			fileTypeDesc : '图片文件',
			fileTypeExts : '*.gif; *.jpg; *.png',
			fileSizeLimit: 2048,
			queueSizeLimit: 1,
			multi: false,
			uploader:"/manage/upload.json",
			uploadScript: "/manage/upload.json",
			success: function(file ,data){
				
				var form = $("#form-real-estate-picture");
				var file = JSON.parse(data);
				
				form.find("input[name=Title]").val(file.Name)
				form.find('input[name="Resource[Id]"]').val(file.Id)
				$('#pic-preview').attr("src", file.Path)
			}
		});
		
		$("#form-real-estate-picture").submit(function(){
			
			if(!$(this).valid()){
				
				$(this).find("textarea.error, input.error, select.error").first().focus();
				return false; 
			}
			
			var vals = $(this).serializeJSON()
			
			JWS("/manage/picture/upsert.json", vals).success(function(data){
				
				alert("Success!");
			})
			
			return false;
		});
		
		$(".form-datetime").datepicker({
            autoclose: true,
            format: "yyyy-mm-dd",
            pickerPosition: "bottom-left"
        });
		
		$("#form-real-estate-enviroment").submit(function(){
			
			if(!$(this).valid()){
				
				$(this).find("input.error, select.error").first().focus();
				return false; 
			}
			
			var vals = $(this).serializeJSON()
			
			JWS("/manage/real-estate/upsert.json", vals).success(function(data){
				
				Metronic.alert({
                    type: 'success',
                    icon: 'check',
                    message: '保存成功...',
                    container: $(".page-content"),
                    place: 'prepend',
                    closeInSeconds: 3
                });
			})
			
			return false;
		})
		
		$("#form-real-estate").submit(function(){
			
			CKEDITOR.instances['Remark'].updateElement();

			if(!$(this).valid()){
				
				$(this).find("input.error, select.error").first().focus();
				return false; 
			}
			
			var vals = $(this).serializeJSON()
			
			if(vals.Captions){
				vals.Captions = vals.Captions.toUpperCase().split("");
			}else{
				delete vals.Open;
			}
			
			if(vals.Open){
				vals.Open = new Date(vals.Open) / 1000;
			}else{
				delete vals.Open;
			}
			
			vals.Features = tags(vals.Features);
			
			if(vals.Delivery){
				vals.Delivery = new Date(vals.Delivery) / 1000;
			}else{
				delete vals.Delivery;
			}
			
			if(vals.GroupClose){
				vals.GroupClose = new Date(vals.GroupClose) / 1000;
			}else{
				delete vals.GroupClose
			}
			
			if(!vals.Logo.Id){
				delete vals.Logo.Id;
				delete vals.Logo;
			}
			
			if(!vals.Cover.Id){
				delete vals.Cover.Id;
				delete vals.Cover;
			}
			
			JWS("/manage/real-estate/upsert.json", vals).success(function(data){
				
				window.location.href = "./index.html";
			})
			
			return false;
		})
	}
	
    return {
    	
        init: function () {
        	
        	FormInits();
        }
    };
}();
</script>
<!-- END   CURRENT CONTEXT -->